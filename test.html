<!doctype html>
<html>
    <head>
        <script src="iml.js"></script>
        <script src="api.js"></script>
        <style>
            #editor {
                position: absolute;
                top:      8px;
                left:     8px;
                right:    8px;
                height:   400px;
            }

            #output {
                position: absolute;
                top:      422px;
                left:     8px;
                right:    8px;
                bottom:   8px;

                font-family: monospace;

                padding: 8px;

                background-color: #dddddd;
            }
        </style>
    </head>
    <body>
        <textarea id="editor">&lt;?xml version="1.0"?&gt;</textarea>
        <div id="output"></div>
    </body>
    <script>
        var editor = document.getElementById("editor");
        var output = document.getElementById("output");

        var onchange = function() {
            output.innerHTML = "";
            var logEntry = 0;
            function log(text) {
                var item = document.createElement("span");
                item.innerText = (logEntry++) + ": " + text;
                output.appendChild(item);
                output.appendChild(document.createElement("br"));
            }

            var parser = new DOMParser();
            var doc = parser.parseFromString(editor.value,
                                             "application/xml");
            if (doc.body && doc.body.firstChild.tagName === "parsererror") {
                output.appendChild(doc.body.firstChild);
                return;
            }

            IML.instantiate(doc.firstChild, API.meta(log));
        };

        editor.onkeyup  = onchange;
        editor.onchange = onchange;
    </script>
</html>

